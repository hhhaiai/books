(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{549:function(s,t,a){"use strict";a.r(t);var e=a(2),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("这是一个介绍 Android 属性系统的系列文章:")]),s._v(" "),t("ul",[t("li",[s._v("Android 属性系统入门")]),s._v(" "),t("li",[s._v("属性文件生成过程分析")]),s._v(" "),t("li",[s._v("如何添加系统属性")]),s._v(" "),t("li",[s._v("属性与 Selinux （本文）")]),s._v(" "),t("li",[s._v("属性系统整体框架与启动过程分析")]),s._v(" "),t("li",[s._v("属性读写过程源码分析")])]),s._v(" "),t("p",[s._v("Android O 以后，属性的 Selinux 的规则变得复杂起来了，今天我们先看一个简单的例子，做基本的了解。在"),t("code",[s._v("Hal与硬件服务")]),s._v("的 treble 章节我们还会继续来学习属性相关的 Selinux 配置。")]),s._v(" "),t("h2",{attrs:{id:"读写属性的示例代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#读写属性的示例代码"}},[s._v("#")]),s._v(" 读写属性的示例代码")]),s._v(" "),t("p",[s._v("首先我们在 "),t("code",[s._v("device/jelly/rice14")]),s._v(" 目录下创建如下的目录：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("PropTest/\n├── Android.bp\n└── prop_test.cpp\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("其中 "),t("code",[s._v("prop_test.cpp")]),s._v(" 具体内容如下：")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("<string>")])]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("<cutils/properties.h>")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token macro-name"}},[s._v("LOG_TAG")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prop_test"')])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("<log/log.h>")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("<android-base/properties.h>")])]),s._v("\n \n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("namespace")]),s._v(" std"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" argc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("argv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 打印版本信息")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" android_version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("PROPERTY_VALUE_MAX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("property_get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ro.build.version.release"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" android_version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ALOGD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"android version : %s"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" android_version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 写入自定义属性")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("property_set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vendor.my.prop.test"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxx"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 读自定义属性")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" prop_test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("PROPERTY_VALUE_MAX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("property_get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vendor.my.prop.test"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" prop_test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ALOGD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prop test : %s"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" prop_test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("p",[s._v("配套的编译文件 "),t("code",[s._v("Android.bp")]),s._v(" 如下：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("cc_binary "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prop_test"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    srcs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prop_test.cpp"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    vendor"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    shared_libs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"libbase"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"liblog"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"libcutils"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"libutils"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("至此，整个示例程序就完成了，最后修改我们自定义 Product 的配置文件 "),t("code",[s._v("device/jelly/rice14/rice14.mk")]),s._v(" :")]),s._v(" "),t("div",{staticClass:"language-Makefile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-makefile"}},[t("code",[s._v("PRODUCT_PACKAGES "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ......")]),s._v("\n    prop_test \\\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"selinux-的配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#selinux-的配置"}},[s._v("#")]),s._v(" Selinux 的配置")]),s._v(" "),t("p",[s._v("接着需要配置 SeLinux：")]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("device/jelly/rice14")]),s._v(" 目录下创建如下的文件与目录：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("sepolicy/\n├── file_contexts\n├── property_contexts\n├── property.te\n└── prop_te\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("不要忘了配置自定义 sepolicy 目录，在 "),t("code",[s._v("device/jelly/rice14/rice14.mk")]),s._v(" 中添加如下内容：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("BOARD_SEPOLICY_DIRS "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    device/jelly/rice14/sepolicy\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("首先在 "),t("code",[s._v("property.te")]),s._v(" 中定义属性类型")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("type vendor_mytest_prop, property_type;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("接着在 "),t("code",[s._v("property_contexts")]),s._v(" 中配置好我们自定义属性 "),t("code",[s._v("vendor.my.prop.test")]),s._v(" 的安全上下文：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("vendor.my.prop.test u:object_r:vendor_mytest_prop:s0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("接着在 "),t("code",[s._v("prop_test.te")]),s._v(" 中配置好可执行文件和对应进程的类型和域转换规则以及属性的读写权限：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可执行文件对应进程类型")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v("  myprop_test_dt, domain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可执行文件类型")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" myprop_test_dt_exec, exec_type, vendor_file_type, file_type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 域转换规则")]),s._v("\ninit_daemon_domain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("myprop_test_dt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndomain_auto_trans"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("shell, myprop_test_dt_exec, myprop_test_dt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 属性读写规则")]),s._v("\nset_prop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("myprop_test_dt, vendor_mytest_prop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nget_prop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("myprop_test_dt, vendor_mytest_prop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nget_prop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("myprop_test_dt, exported2_default_prop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("在属性读写规则中，我们添加了对 "),t("code",[s._v("exported2_default_prop")]),s._v(" 类型属性的读取规则，"),t("code",[s._v("exported2_default_prop")]),s._v(" 是源码中 "),t("code",[s._v("ro.build.version.release")]),s._v(" 属性对应的 type，我是通过如下的搜索命令查找到的：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"property_contexts"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" ro.build.version.release\n./system/sepolicy/public/property_contexts:ro.build.version.release u:object_r:exported2_default_prop:s0 exact string\n./system/sepolicy/prebuilts/api/29.0/public/property_contexts:ro.build.version.release u:object_r:exported2_default_prop:s0 exact string\n./system/sepolicy/prebuilts/api/28.0/public/property_contexts:ro.build.version.release u:object_r:exported2_default_prop:s0 exact string\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("最后我们需要再 "),t("code",[s._v("file_contexts")]),s._v(" 中配置可执行文件的安全上下文：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("/vendor/bin/prop_test                   u:object_r:myprop_test_dt_exec:s0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("接着我们就可以执行在虚拟机的 shell 中执行 prop_test 可执行文件了:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新编译源码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" build/envsetup.sh\nlunch rice14-eng\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j16")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动虚拟机")]),s._v("\nemulator\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重开一个终端，进入虚拟机 shell 环境")]),s._v("\nadb shell\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# root")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# selinux 配置为 Permissive 模式")]),s._v("\nsetenforce "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 退出 root")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\nprop_test\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("接着我们查看 log：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("logcat "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" prop_test                                                          \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":25:42.420  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2959")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2959")]),s._v(" W prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":27"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"u:object_r:vendor_mytest_prop:s0"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tmpfs"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6750")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:shell:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:object_r:vendor_mytest_prop:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("file "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":25:42.424  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2959")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2959")]),s._v(" D prop_test: android version "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":25:42.428  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2959")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2959")]),s._v(" D prop_test: prop "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":29:41.930  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3704")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3704")]),s._v(" W prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":58"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" use "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/pts/0"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"devpts"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:myprop_test_dt:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:adbd:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":29:41.930  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3704")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3704")]),s._v(" W prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":60"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" use "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/pts/0"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"devpts"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:myprop_test_dt:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:adbd:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":29:41.930  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3704")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3704")]),s._v(" W prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":61"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" use "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/goldfish_pipe"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tmpfs"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7279")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:myprop_test_dt:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:adbd:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":29:41.930  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3704")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3704")]),s._v(" W prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":62"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" use "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/goldfish_pipe"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tmpfs"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7279")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:myprop_test_dt:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:adbd:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":31:17.980  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3919")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3919")]),s._v(" I prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":87"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" use "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/pts/0"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"devpts"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:myprop_test_dt:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:adbd:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":31:17.980  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3919")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3919")]),s._v(" I prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":88"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/pts/0"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"devpts"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:myprop_test_dt:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:object_r:devpts:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("chr_file "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":31:17.980  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3919")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3919")]),s._v(" I prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":89"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"socket:[9765]"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sockfs"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9765")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:myprop_test_dt:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:adbd:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unix_stream_socket "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":31:17.980  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3919")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3919")]),s._v(" I prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":90"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" use "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/vendor/bin/prop_test"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dm-1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("158")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:myprop_test_dt:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:shell:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":31:18.000  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3919")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3919")]),s._v(" D prop_test: android version "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":31:18.002  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3919")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3919")]),s._v(" D prop_test: prop "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" xxx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("发现我们的程序任然缺少一些权限，我们把权限相关的 log 拷贝下来，在源码根目录下新建一个 avc_log.txt 文件，把缺少权限相关的 log 拷贝进去：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# avc_log.txt")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":38:05.670  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2910")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2910")]),s._v(" W prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":28"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" use "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/pts/0"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"devpts"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:myprop_test_dt:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:adbd:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":38:05.670  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2910")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2910")]),s._v(" W prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":30"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" use "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/pts/0"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"devpts"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:myprop_test_dt:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:adbd:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":38:05.670  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2910")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2910")]),s._v(" W prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":31"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" use "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"socket:[10955]"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sockfs"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10955")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:myprop_test_dt:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:adbd:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":38:05.670  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2910")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2910")]),s._v(" W prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" use "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/goldfish_pipe"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tmpfs"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7343")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:myprop_test_dt:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:adbd:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":38:57.400  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3034")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3034")]),s._v(" I prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":39"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" use "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/pts/0"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"devpts"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:myprop_test_dt:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:adbd:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":38:57.400  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3034")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3034")]),s._v(" I prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":40"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/pts/0"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"devpts"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:myprop_test_dt:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:object_r:devpts:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("chr_file "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":38:57.400  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3034")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3034")]),s._v(" I prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":41"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"socket:[10955]"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sockfs"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10955")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:myprop_test_dt:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:adbd:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unix_stream_socket "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-23 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":38:57.410  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3034")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3034")]),s._v(" I prop_test: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1400")]),s._v(" audit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(":42"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": avc: denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" use "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/vendor/bin/prop_test"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dm-1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ino")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("158")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("scontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:myprop_test_dt:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tcontext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u:r:shell:s0 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("permissive")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("接着执行命令 "),t("code",[s._v("audit2allow -i avc_log.txt")]),s._v(" 生成缺失的权限配置:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("allow myprop_test_dt adbd:fd use"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nallow myprop_test_dt adbd:unix_stream_socket "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nallow myprop_test_dt devpts:chr_file "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nallow myprop_test_dt shell:fd use"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("把这些权限配置加入到 "),t("code",[s._v("prop_test.te")]),s._v(" 后，重新编译系统，启动虚拟机，程序即可正常运行。")]),s._v(" "),t("h2",{attrs:{id:"关于"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关于"}},[s._v("#")]),s._v(" 关于")]),s._v(" "),t("p",[s._v("我叫阿豪，2015 年本科毕业于国防科学技术大学指挥信息系统专业，毕业后从事信息化装备的研发工作。")]),s._v(" "),t("p",[s._v("如果你对 Android Framework 感兴趣或者正在学习 Android Framework，可以关注我的微信公众号和抖音，我会持续分享我的学习经验，帮助正在学习的你少走一些弯路。学习过程中如果你有疑问或者你的经验想要分享给大家可以添加我的微信，我拉你进技术交流群。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/zzh0838/MyImages@main/img/%E4%BA%8C%E7%BB%B4%E7%A0%81.jpg",alt:""}})])])}),[],!1,null,null,null);t.default=n.exports}}]);